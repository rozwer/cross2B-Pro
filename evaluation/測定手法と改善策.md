# 測定手法と改善策

> **最終更新**: 2026-02-25

---

## 1. 評価指標と測定方法

### 1.1 定量指標

| 指標 | 測定方法 | 目標値 | 現状（v3） |
|------|---------|--------|-----------|
| jReadability | jreadability.net にstep7a本文を貼付 | 3.0以上 | 2.97 |
| 文字数（step9） | `len(final_content)` | 10,000文字以上 | 12,696 |
| 文字数（step10合計） | 4記事合計 | 20,000文字以上 | 23,831 |
| H2数 | `content.count('## ')` | 40以上 | 34 |
| 統計データ数 | 正規表現 `[\d,.]+[%倍万億件社人名]` | 30以上 | 46 |
| 脚注参照数 | 正規表現 `\[[\d]+\]` | 8以上 | 5 |
| CTA指標数 | 「無料」「お問い合わせ」「資料」「相談」の出現回数 | 10以上 | 14 |
| FAQ項目数 | step8 `faq_items` の件数 | 8以上 | 12 |
| コスト | `GET /api/runs/{id}/cost` のtotal_cost | $2.00以下 | $1.41 |

### 1.2 jReadability測定手順

1. 対象runのstep7a output.jsonから`draft`フィールドを取得
2. Markdownの見出し記号（`##`, `###`）・脚注（`<sup>`）・区切り線（`---`）を除去
3. https://jreadability.net/ に本文テキストを貼付
4. 「上級前半」(3.0-3.5)が目標、「上級後半」(2.5-3.0)は許容

**基準値**:
| テキスト | jReadability |
|---------|-------------|
| 手動作成元記事 | 3.1 |
| gemini-2.5-pro + v3プロンプト | 2.97 |
| gemini-3-pro-preview + v3プロンプト | 2.50-2.91 |
| 旧プロンプト（v1） | 1.66 |

### 1.3 コスト測定

APIエンドポイント: `GET /api/runs/{run_id}/cost`

レスポンスに含まれるデータ:
- ステップ別 input/output/thinking トークン数
- ステップ別・合計コスト（USD）
- 使用モデル名

**料金テーブル**（per 1Kトークン、`apps/api/routers/cost.py`で管理）:

| モデル | Input | Output | Thinking |
|--------|-------|--------|----------|
| gemini-2.5-pro | $0.00125 | $0.01 | $0.00125 |
| gemini-3-pro-preview | $0.002 | $0.012 | $0.002 |
| gemini-2.5-flash | $0.00015 | $0.0006 | $0.00015 |

### 1.4 SEO品質の手動評価項目

定性評価は以下の5軸で行う（各10点満点）:

| 軸 | チェック内容 |
|----|------------|
| 統計データ | 具体的数値があるか。「約」「程度」ではなく正確な数値か |
| 出典明記 | 権威ソース（政府統計、業界団体）を脚注形式で引用しているか |
| CTA配置 | Early（導入後）・Mid（中盤）・Final（まとめ前）の3段階で配置されているか |
| 見出し構造 | H2にキーワードが含まれるか。H2/H3の階層が論理的か |
| 読みやすさ | 1文18語以下。漢語率30%以下。専門用語に言い換えがあるか |

---

## 2. 現行プロンプトの強み

v3プロンプト（`apps/api/prompts/packs/default.json`）の特徴:

| 施策 | 効果 | 根拠 |
|------|------|------|
| readability制約（18語/35文字） | jReadability 1.66→2.97 | R1-R3テストで検証 |
| 漢語率30%制約 | 読みやすさ向上 | R3で35%→30%に絞り込み |
| 行動経済学フレームワーク | CTA指標 0→14 | Phase導入で体系的に配置 |
| 業界別ソースマップ | 統計データ数 0→46 | step5で権威ソースを指定 |
| CTA 3段階配置指示 | Early/Mid/Final配置達成 | step9で位置検証 |
| 人間味生成（step3_5） | 共感型導入 | 感情フック・体験エピソード生成 |

---

## 3. 残課題と改善策

### 3.1 優先度:高

#### 脚注の品質改善

**現状**: step9で5件の脚注番号が振られるが、参考文献リストにURL・正式名称が不完全。step10（4記事展開）で脚注が消失する。

**原因**:
- step7a/step9で脚注を生成するが、出典URLはstep5のソースデータに依存
- step10は各記事を独立生成するため、元の脚注コンテキストが失われる

**改善策**:
1. step6_5（統合パッケージ）に「引用可能ソースリスト」を含め、step10がそれを参照
2. step10プロンプトに「脚注は必ず元記事のものを維持すること」を追加
3. step10後のバリデーションで脚注数を検証

#### 権威ソースの明示化

**現状**: 「帝国データバンクの調査によると」のように本文中に言及はあるが、厚労省・国交省などの複数ソースが不足。

**改善策**:
1. step5プロンプトの必須ソースマップをより厳格に（URLまで収集を要求）
2. step6で`statistics_placement_map`に出典URLを含める
3. step9で脚注形式 `<sup id="refN">[N]</sup>` + 参考文献リストを厳格化

### 3.2 優先度:中

#### H2数の最適化

**現状**: 34（元記事47）。1H2あたりのコンテンツ量は生成記事の方が多い。

**改善策**:
- step4（骨格作成）で「H2は最低40個」を明示
- 競合記事のH2数をstep1で取得し、step4に渡す

#### step5のタイムアウト

**現状**: 政府系サイト（chusho.meti.go.jp等）でタイムアウトが連発し、step5だけで12分超。

**改善策**:
- タイムアウトを30秒→15秒に短縮（3リトライ × 15秒 = 45秒で判定）
- 統計データのキャッシュ機能（同じURLは24時間キャッシュ）
- PDF取得の上限サイズを引き下げ（現在の大きいPDFは自動スキップ済み）

### 3.3 優先度:低

#### step10での記事間差別化

**現状**: 記事1と記事2のタイトルが類似（「初心者向け」重複）。

**改善策**:
- step10プロンプトで各記事のペルソナ・切り口を明確化
- 前記事のタイトルを参照して重複を避ける指示

---

## 4. モデル比較

| モデル | jReadability | コスト/回 | 統計データ品質 | 推奨用途 |
|--------|-------------|----------|--------------|---------|
| gemini-2.5-pro | 2.97 | $1.41 | 高 | 本番推奨 |
| gemini-3-pro-preview | 2.50-2.91 | $1.70（推定） | 高 | 品質最優先時 |
| gemini-2.5-flash | 未測定 | $0.15（推定） | 中 | テスト・軽量用途 |
| claude-sonnet-4.6 | 未測定 | $3.50（推定） | 高 | 代替候補 |

**現行推奨**: gemini-2.5-pro（コスト/品質バランス最良）

---

## 5. 評価フロー

```
1. 実行
   curl -X POST /api/runs -d '{"input":{"keyword":"..."},"model_config":{"platform":"gemini","model":"gemini-2.5-pro"}}'

2. 承認（2回）
   POST /api/runs/{id}/step1/approve
   POST /api/runs/{id}/approve

3. step11スキップ（画像不要時）
   POST /api/runs/{id}/step11/skip

4. コスト確認
   GET /api/runs/{id}/cost

5. 品質確認
   - MinIOからstep7a/step9/step10のoutput.jsonを取得
   - 定量指標を計測
   - jReadabilityを外部サイトで測定
   - 元記事と定性比較
```
