---
name: {{WORKFLOW_FRAMEWORK_LOWER}}-fundamentals
description: {{WORKFLOW_FRAMEWORK}} の基本概念と使い方
---

# /{{WORKFLOW_FRAMEWORK_LOWER}}-fundamentals - 基本概念

> {{WORKFLOW_FRAMEWORK}} の基礎知識とプロジェクト固有の設定

---

## 概要

このスキルは `options.json` の `workflow_framework` 設定に基づいて展開されます。
{{WORKFLOW_FRAMEWORK}} を使用したワークフロー開発の基本概念を提供します。

---

## 基本概念

### ノード（Node）

ワークフローの処理単位。各ノードは特定のタスクを実行します。

```
{{FUNDAMENTALS_NODE_EXAMPLE}}
```

<!-- 使用例:
# LangGraph の場合
def my_node(state: MyState) -> MyState:
    """ノードは状態を受け取り、更新された状態を返す"""
    result = process(state.input)
    return {"output": result}

# Airflow の場合
@task
def my_task(input_data):
    """タスクは入力を受け取り、出力を返す"""
    return process(input_data)
-->

### エッジ（Edge）

ノード間の遷移を定義します。条件付きエッジで分岐も可能です。

```
{{FUNDAMENTALS_EDGE_EXAMPLE}}
```

<!-- 使用例:
# LangGraph の場合
graph.add_edge("node_a", "node_b")
graph.add_conditional_edges("node_a", routing_function)

# Airflow の場合
task_a >> task_b  # シンプルな依存関係
task_a >> [task_b, task_c]  # 並列分岐
-->

### 状態（State）

ワークフロー全体で共有されるデータ構造。

```
{{FUNDAMENTALS_STATE_EXAMPLE}}
```

<!-- 使用例:
# LangGraph の場合
class MyState(TypedDict):
    input: str
    output: str
    messages: Annotated[list, add_messages]

# Airflow の場合（XCom 経由）
@task
def task_a():
    return {"result": "value"}  # XCom に自動保存
-->

### グラフ（Graph）

ノードとエッジを組み合わせた全体構造。

```
{{FUNDAMENTALS_GRAPH_EXAMPLE}}
```

<!-- 使用例:
# LangGraph の場合
graph = StateGraph(MyState)
graph.add_node("step1", step1_node)
graph.add_node("step2", step2_node)
graph.add_edge(START, "step1")
graph.add_edge("step1", "step2")
graph.add_edge("step2", END)
compiled = graph.compile()

# Airflow の場合
with DAG("my_dag", ...) as dag:
    task1 = task_a()
    task2 = task_b()
    task1 >> task2
-->

---

## プロジェクト固有の設定

### ディレクトリ構成

```
{{PROJECT_WORKFLOW_STRUCTURE}}
```

<!-- 使用例:
apps/
├── worker/
│   ├── workflows/       # ワークフロー定義
│   │   ├── __init__.py
│   │   └── article_workflow.py
│   ├── activities/      # アクティビティ/タスク
│   │   ├── __init__.py
│   │   ├── step1.py
│   │   └── step2.py
│   ├── graphs/          # LangGraph グラフ定義
│   │   └── step_graph.py
│   └── main.py          # エントリーポイント
-->

### 設定ファイル

```
{{PROJECT_WORKFLOW_CONFIG}}
```

<!-- 使用例:
# config/workflow.yaml
workflow:
  framework: langgraph  # or airflow, prefect, dagster
  timeout: 3600
  retry:
    max_attempts: 3
    backoff: exponential
-->

---

## 基本的な使い方

### 1. 新規ワークフローの作成

```bash
/{{WORKFLOW_FRAMEWORK_LOWER}}-fundamentals new <workflow_name>
```

### 2. ワークフローの実行

```bash
{{WORKFLOW_RUN_COMMAND}}
```

<!-- 使用例:
# LangGraph の場合
uv run python -m apps.worker.main

# Airflow の場合
airflow dags trigger my_dag

# Prefect の場合
prefect deployment run my-flow/my-deployment
-->

### 3. 状態の確認

```bash
{{WORKFLOW_STATUS_COMMAND}}
```

---

## ベストプラクティス

### DO（推奨）

```
- 各ノードは単一責任に
- 状態は最小限に保つ
- 大きなデータは外部ストレージに保存
- エラーハンドリングを各ノードで行う
- 冪等性を保つ（同じ入力で同じ出力）
```

### DON'T（非推奨）

```
- ノード内で副作用を隠さない
- 状態に大きなオブジェクトを直接保存しない
- グローバル変数に依存しない
- 例外を握りつぶさない
```

---

## トラブルシューティング

| 症状 | 原因 | 解決策 |
|------|------|--------|
| ノードが実行されない | エッジ設定漏れ | グラフ構造を確認 |
| 状態が消える | 状態更新の誤り | 返り値を確認 |
| タイムアウト | 処理時間超過 | タイムアウト設定を調整 |
| 無限ループ | 終了条件なし | END への遷移を追加 |

---

## 関連スキル

| スキル | 用途 |
|--------|------|
| `/{{WORKFLOW_FRAMEWORK_LOWER}}-patterns` | よく使うパターン |
| `/{{WORKFLOW_FRAMEWORK_LOWER}}-multi-agent` | マルチエージェント構成 |
| `/{{WORKFLOW_FRAMEWORK_LOWER}}-persistence` | 状態の永続化 |
| `/workflow-step-impl` | 工程実装ガイド |

---

## 参考リソース

- 公式ドキュメント: {{WORKFLOW_OFFICIAL_DOCS}}
- 内部ガイド: `docs/{{WORKFLOW_FRAMEWORK_LOWER}}.md`

---

## 変数一覧

| 変数名 | 説明 | 必須 |
|--------|------|------|
| `{{WORKFLOW_FRAMEWORK}}` | フレームワーク名（例: LangGraph） | YES |
| `{{WORKFLOW_FRAMEWORK_LOWER}}` | 小文字（例: langgraph） | YES |
| `{{FUNDAMENTALS_NODE_EXAMPLE}}` | ノードのコード例 | YES |
| `{{FUNDAMENTALS_EDGE_EXAMPLE}}` | エッジのコード例 | YES |
| `{{FUNDAMENTALS_STATE_EXAMPLE}}` | 状態のコード例 | YES |
| `{{FUNDAMENTALS_GRAPH_EXAMPLE}}` | グラフのコード例 | YES |
| `{{PROJECT_WORKFLOW_STRUCTURE}}` | プロジェクト構成 | NO |
| `{{PROJECT_WORKFLOW_CONFIG}}` | 設定ファイル例 | NO |
| `{{WORKFLOW_RUN_COMMAND}}` | 実行コマンド | NO |
| `{{WORKFLOW_STATUS_COMMAND}}` | 状態確認コマンド | NO |
| `{{WORKFLOW_OFFICIAL_DOCS}}` | 公式ドキュメントURL | NO |
