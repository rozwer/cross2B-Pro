---
description: ワークフロー実行の成果物を取得・表示
allowed-tools: Bash, Task, Read, Write, Glob, Grep
---

# /workflow:artifacts

> {{ORCHESTRATOR}} ワークフロー実行の成果物（生成物）を取得・表示する

---

## 実行

{{EXECUTION_STEPS}}

<!-- 使用例:
1. 引数を解析
   - 必須: run_id（実行 ID）
   - オプション: --step, --format, --download

2. 成果物一覧を取得
   - API 経由でファイル一覧取得
   - 各工程の出力を確認
   - メタデータ（digest, size）を取得

3. 成果物を表示/ダウンロード
   - プレビュー表示
   - ファイルダウンロード
   - 特定形式への変換

4. 結果を出力
   - 成果物一覧
   - プレビュー内容
   - ダウンロードパス
-->

---

## 使用例

```bash
# 成果物一覧表示
/workflow:artifacts <run_id>

# 特定工程の成果物
/workflow:artifacts <run_id> --step step3

# JSON 形式で出力
/workflow:artifacts <run_id> --format json

# ファイルをダウンロード
/workflow:artifacts <run_id> --download

# 特定の成果物をダウンロード
/workflow:artifacts <run_id> --step step3 --download --output ./output/

# HTML プレビュー
/workflow:artifacts <run_id> --preview html
```

---

## 引数

| 引数 | 説明 | 必須 | デフォルト |
|------|------|------|-----------|
| `run_id` | 実行 ID | YES | - |
| `--step` | 対象工程 | NO | 全工程 |
| `--format` | 出力形式（text/json/table） | NO | table |
| `--download` | ファイルをダウンロード | NO | false |
| `--output` | ダウンロード先 | NO | `./artifacts/{run_id}/` |
| `--preview` | プレビュー形式（text/html/md） | NO | text |

---

## 成果物の構造

```
storage/{tenant_id}/{run_id}/
├── step1/
│   └── output.json          # 工程1の出力
├── step2/
│   └── output.json          # 工程2の出力
├── step3/
│   ├── step3a/
│   │   └── output.json      # 並列工程3Aの出力
│   ├── step3b/
│   │   └── output.json      # 並列工程3Bの出力
│   └── step3c/
│       └── output.json      # 並列工程3Cの出力
├── step4/
│   └── output.json          # 工程4の出力
└── final/
    ├── article.md           # 最終成果物（Markdown）
    ├── article.html         # 最終成果物（HTML）
    └── metadata.json        # メタデータ
```

---

## 出力

### 成果物一覧

```
[workflow:artifacts]

Run ID: {{run_id}}
ワークフロー: {{workflow_type}}
ステータス: completed

[成果物一覧]
┌─────────┬──────────────────┬────────────┬──────────────────────────────────┐
│ Step    │ File             │ Size       │ Digest (SHA256)                  │
├─────────┼──────────────────┼────────────┼──────────────────────────────────┤
│ step1   │ output.json      │ 1.2 KB     │ a1b2c3d4e5f6...                  │
│ step2   │ output.json      │ 3.5 KB     │ b2c3d4e5f6a1...                  │
│ step3a  │ output.json      │ 8.2 KB     │ c3d4e5f6a1b2...                  │
│ step3b  │ output.json      │ 12.4 KB    │ d4e5f6a1b2c3...                  │
│ step3c  │ output.json      │ 2.1 KB     │ e5f6a1b2c3d4...                  │
│ step4   │ output.json      │ 45.6 KB    │ f6a1b2c3d4e5...                  │
│ final   │ article.md       │ 48.2 KB    │ a2b3c4d5e6f7...                  │
│ final   │ article.html     │ 52.1 KB    │ b3c4d5e6f7a2...                  │
│ final   │ metadata.json    │ 0.8 KB     │ c4d5e6f7a2b3...                  │
└─────────┴──────────────────┴────────────┴──────────────────────────────────┘

合計: 9 ファイル, 174.1 KB

[コスト情報]
- 総トークン使用量: 125,430 tokens
- 推定コスト: $0.45
```

### 特定工程の詳細

```
[workflow:artifacts --step step3]

Run ID: {{run_id}}
対象工程: step3

[Step 3A: 構成案]
{
  "sections": [
    {"title": "SEOとは何か", "target_words": 800},
    {"title": "キーワード選定", "target_words": 1000},
    {"title": "コンテンツ最適化", "target_words": 1200},
    {"title": "技術的SEO", "target_words": 900},
    {"title": "効果測定", "target_words": 700}
  ],
  "total_target_words": 4600,
  "metrics": {
    "tokens_used": 1523,
    "duration_ms": 2340
  }
}

[Step 3B: 詳細化]
(省略: --verbose で表示)

[Step 3C: タイトル案]
{
  "titles": [
    "SEO対策の完全ガイド2025年版",
    "検索順位を上げる実践的SEO戦略",
    "初心者でもわかるSEO基礎と応用"
  ],
  "recommended": 0
}
```

### プレビュー表示

```
[workflow:artifacts --preview html]

Run ID: {{run_id}}
プレビュー: final/article.html

───────────────────────────────────────────────────────────────
<!DOCTYPE html>
<html>
<head>
  <title>SEO対策の完全ガイド2025年版</title>
  <meta name="description" content="...">
</head>
<body>
  <article>
    <h1>SEO対策の完全ガイド2025年版</h1>
    <section>
      <h2>SEOとは何か</h2>
      <p>SEO（Search Engine Optimization）とは...</p>
    </section>
    ...
  </article>
</body>
</html>
───────────────────────────────────────────────────────────────

[表示オプション]
- ブラウザで開く: /workflow:artifacts {{run_id}} --preview html --open
- Markdown で表示: /workflow:artifacts {{run_id}} --preview md
```

### ダウンロード完了

```
[workflow:artifacts --download 完了]

Run ID: {{run_id}}
ダウンロード先: ./artifacts/{{run_id}}/

[ダウンロードしたファイル]
┌─────────────────────────────────────────┬────────────┐
│ File                                    │ Size       │
├─────────────────────────────────────────┼────────────┤
│ ./artifacts/{{run_id}}/step1/output.json│ 1.2 KB     │
│ ./artifacts/{{run_id}}/step2/output.json│ 3.5 KB     │
│ ./artifacts/{{run_id}}/final/article.md │ 48.2 KB    │
│ ./artifacts/{{run_id}}/final/article.html│ 52.1 KB   │
└─────────────────────────────────────────┴────────────┘

合計: 9 ファイル, 174.1 KB

[監査ログ]
ID: audit-12347
記録: ダウンロード完了
```

---

## 実装詳細

### API 経由

```bash
{{API_ARTIFACTS_COMMAND}}
```

<!-- 使用例:
```bash
# ファイル一覧
curl http://localhost:8000/api/runs/{{run_id}}/files \
  -H "Authorization: Bearer $TOKEN"

# 特定工程の出力
curl http://localhost:8000/api/runs/{{run_id}}/files/step3 \
  -H "Authorization: Bearer $TOKEN"

# ファイル内容取得
curl http://localhost:8000/api/runs/{{run_id}}/files/final/article.md/content \
  -H "Authorization: Bearer $TOKEN"

# HTML プレビュー
curl http://localhost:8000/api/runs/{{run_id}}/preview \
  -H "Authorization: Bearer $TOKEN"
```
-->

### Storage 直接アクセス

```bash
{{STORAGE_ACCESS_COMMAND}}
```

<!-- 使用例（MinIO）:
```bash
# MinIO CLI
mc ls local/storage/{{tenant_id}}/{{run_id}}/

# ファイル取得
mc cp local/storage/{{tenant_id}}/{{run_id}}/final/article.md ./
```
-->

---

## 成果物の契約フィールド

| フィールド | 説明 |
|-----------|------|
| `output_path` | Storage 上のパス |
| `output_digest` | SHA256 ハッシュ |
| `summary` | 内容の要約（UI/ログ用） |
| `metrics` | トークン使用量・文字数等 |

---

## 前提条件

- {{ORCHESTRATOR}} が稼働中
- Storage サービス（MinIO 等）が稼働中
- 有効な認証トークン

---

## 関連コマンド

| コマンド | 説明 |
|----------|------|
| `/workflow:run` | 実行状態の確認 |
| `/workflow:approve` | 承認待ち工程の承認（成果物確認後） |
| `/workflow:new` | 新規実行開始 |

---

## 手動実行

コマンドを使わずに手動で実行する場合:

```bash
# API 直接呼び出し
{{MANUAL_API_ARTIFACTS_COMMAND}}

# Storage 直接アクセス
{{MANUAL_STORAGE_COMMAND}}
```

---

## トラブルシューティング

| 症状 | 原因 | 解決策 |
|------|------|--------|
| `File not found` | 工程未完了 | `/workflow:run` で状態確認 |
| `Access denied` | 権限エラー | 認証トークン確認 |
| `Storage error` | MinIO 停止 | `/dev:health` で確認 |
| `Digest mismatch` | データ破損 | 再実行が必要 |

---

## 変数一覧

| 変数名 | 説明 | 必須 |
| ------ | ---- | ---- |
| `{{ORCHESTRATOR}}` | オーケストレーター名 | YES |
| `{{WORKFLOW_FRAMEWORK}}` | ワークフローフレームワーク | YES |
| `{{EXECUTION_STEPS}}` | 実行ステップ | YES |
| `{{API_ARTIFACTS_COMMAND}}` | API 経由の成果物取得コマンド | YES |
| `{{STORAGE_ACCESS_COMMAND}}` | Storage 直接アクセスコマンド | YES |
| `{{MANUAL_API_ARTIFACTS_COMMAND}}` | 手動 API コマンド | YES |
| `{{MANUAL_STORAGE_COMMAND}}` | 手動 Storage コマンド | YES |
