---
description: 新規ワークフロー実行を開始
allowed-tools: Bash, Task, Read, Write, Glob, Grep
---

# /workflow:new

> 新規の {{ORCHESTRATOR}} ワークフロー実行を開始する

---

## 実行

{{EXECUTION_STEPS}}

<!-- 使用例:
1. 引数を解析
   - 必須: workflow_type（ワークフロータイプ）
   - オプション: --params, --dry-run, --wait

2. 前提条件を確認
   - {{ORCHESTRATOR}} が起動していること
   - 必要なサービス（DB/Storage）が稼働中
   - 認証トークンが有効

3. ワークフローを開始
   - API または CLI 経由で実行開始
   - 初期パラメータを渡す
   - run_id を取得

4. 結果を出力
   - run_id
   - 実行 URL（UI へのリンク）
   - 初期状態
-->

---

## 使用例

```bash
# 基本的な使い方
/workflow:new <workflow_type>

# パラメータ付き
/workflow:new article --params '{"keyword": "SEO対策", "target_length": 5000}'

# ドライラン（実行せずに確認）
/workflow:new article --dry-run

# 完了まで待機
/workflow:new article --wait
```

---

## 引数

| 引数 | 説明 | 必須 | デフォルト |
|------|------|------|-----------|
| `workflow_type` | ワークフロータイプ | YES | - |
| `--params` | 初期パラメータ（JSON） | NO | `{}` |
| `--dry-run` | 実行せずに確認 | NO | false |
| `--wait` | 完了まで待機 | NO | false |
| `--tenant` | テナント ID | NO | 現在のテナント |

---

## ワークフロータイプ

| タイプ | 説明 |
|--------|------|
| {{WORKFLOW_TYPES}} |

<!-- 使用例:
| `article` | 記事生成ワークフロー |
| `analysis` | データ分析ワークフロー |
| `migration` | データ移行ワークフロー |
-->

---

## 前提条件

- {{ORCHESTRATOR}} が稼働中（`/dev:health` で確認）
- DB/Storage サービスが正常
- 必要な API キーが設定済み

---

## 実装詳細

### API 経由

```bash
{{API_START_COMMAND}}
```

<!-- 使用例（Temporal）:
```bash
# Temporal CLI 経由
temporal workflow start \
  --task-queue {{TASK_QUEUE}} \
  --type {{WORKFLOW_TYPE}} \
  --workflow-id "run-$(date +%s)" \
  --input '{"keyword": "SEO対策"}'

# API 経由
curl -X POST http://localhost:8000/api/runs \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"workflow_type": "article", "params": {"keyword": "SEO対策"}}'
```
-->

### CLI 経由

```bash
{{CLI_START_COMMAND}}
```

---

## 出力

### 成功時

```
[workflow:new 完了]

ワークフロータイプ: {{workflow_type}}
Run ID: {{run_id}}
ステータス: started

[詳細]
- 開始時刻: 2025-01-01 12:00:00
- パラメータ: {"keyword": "SEO対策"}
- UI: {{WORKFLOW_UI_URL}}/runs/{{run_id}}

[次のステップ]
- /workflow:run {{run_id}} で進捗確認
- /workflow:approve {{run_id}} で承認待ち工程を承認
```

### 失敗時

```
[workflow:new 失敗]

ワークフロータイプ: {{workflow_type}}
ステータス: failed
エラー: {{error_message}}

[推奨アクション]
1. /dev:health でサービス状態を確認
2. /dev:logs で詳細ログを確認
3. パラメータを修正して再実行
```

---

## エラーハンドリング

| エラー | 原因 | 対処 |
|--------|------|------|
| `Service unavailable` | {{ORCHESTRATOR}} 未起動 | `/dev:up` で起動 |
| `Invalid params` | パラメータ不正 | JSON 形式を確認 |
| `Unauthorized` | 認証エラー | トークンを再取得 |
| `Duplicate workflow` | 同一 ID 存在 | 別の workflow_id を使用 |

---

## 関連コマンド

| コマンド | 説明 |
|----------|------|
| `/workflow:run` | 実行状態の確認 |
| `/workflow:approve` | 承認待ち工程の承認 |
| `/workflow:artifacts` | 成果物の取得 |
| `/dev:health` | サービス状態確認 |

---

## 手動実行

コマンドを使わずに手動で実行する場合:

```bash
# {{ORCHESTRATOR}} CLI
{{MANUAL_CLI_COMMAND}}

# API 直接呼び出し
{{MANUAL_API_COMMAND}}
```

---

## 変数一覧

| 変数名 | 説明 | 必須 |
| ------ | ---- | ---- |
| `{{ORCHESTRATOR}}` | オーケストレーター名（Temporal 等） | YES |
| `{{WORKFLOW_FRAMEWORK}}` | ワークフローフレームワーク | YES |
| `{{EXECUTION_STEPS}}` | 実行ステップ | YES |
| `{{WORKFLOW_TYPES}}` | ワークフロータイプ一覧 | YES |
| `{{API_START_COMMAND}}` | API 経由の開始コマンド | YES |
| `{{CLI_START_COMMAND}}` | CLI 経由の開始コマンド | YES |
| `{{TASK_QUEUE}}` | タスクキュー名 | YES |
| `{{WORKFLOW_UI_URL}}` | ワークフロー UI の URL | YES |
| `{{MANUAL_CLI_COMMAND}}` | 手動 CLI コマンド | YES |
| `{{MANUAL_API_COMMAND}}` | 手動 API コマンド | YES |
