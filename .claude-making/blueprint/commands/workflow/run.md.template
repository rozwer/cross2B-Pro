---
description: ワークフロー実行の状態を確認
allowed-tools: Bash, Task, Read, Glob, Grep
---

# /workflow:run

> {{ORCHESTRATOR}} ワークフロー実行の状態を確認・監視する

---

## 実行

{{EXECUTION_STEPS}}

<!-- 使用例:
1. 引数を解析
   - 必須: run_id（実行 ID）
   - オプション: --watch, --verbose, --format

2. 実行状態を取得
   - API または CLI 経由で状態取得
   - 各工程の進捗を確認
   - 失敗した工程があれば詳細を取得

3. 結果を出力
   - 全体状態（running/paused/completed/failed）
   - 各工程の状態
   - 経過時間
-->

---

## 使用例

```bash
# 基本的な使い方
/workflow:run <run_id>

# 継続監視（リアルタイム更新）
/workflow:run <run_id> --watch

# 詳細表示
/workflow:run <run_id> --verbose

# JSON 形式で出力
/workflow:run <run_id> --format json

# 最新の実行を確認
/workflow:run --latest
```

---

## 引数

| 引数 | 説明 | 必須 | デフォルト |
|------|------|------|-----------|
| `run_id` | 実行 ID | YES* | - |
| `--latest` | 最新の実行を表示 | NO | false |
| `--watch` | 継続監視 | NO | false |
| `--verbose` | 詳細表示 | NO | false |
| `--format` | 出力形式（text/json） | NO | text |

*`--latest` 指定時は不要

---

## 状態一覧

| 状態 | 説明 | 次のアクション |
|------|------|----------------|
| `running` | 実行中 | 待機 or `/workflow:run --watch` |
| `paused` | 承認待ち | `/workflow:approve` |
| `completed` | 完了 | `/workflow:artifacts` で成果物取得 |
| `failed` | 失敗 | ログ確認 → 修正 → 再実行 |
| `cancelled` | キャンセル済み | 新規実行 |
| `timed_out` | タイムアウト | 設定確認 → 再実行 |

---

## 出力

### 成功時（実行中）

```
[workflow:run]

Run ID: {{run_id}}
ワークフロー: {{workflow_type}}
ステータス: running
開始時刻: 2025-01-01 12:00:00
経過時間: 5m 30s

[工程進捗]
┌─────────┬────────────┬──────────┬────────────┐
│ Step    │ Status     │ Duration │ Updated    │
├─────────┼────────────┼──────────┼────────────┤
│ Step 1  │ ✓ completed│ 1m 20s   │ 12:01:20   │
│ Step 2  │ ✓ completed│ 2m 10s   │ 12:03:30   │
│ Step 3A │ ▶ running  │ 2m 00s   │ 12:05:30   │
│ Step 3B │ ⏳ pending  │ -        │ -          │
│ Step 3C │ ⏳ pending  │ -        │ -          │
└─────────┴────────────┴──────────┴────────────┘

[詳細]
- 現在のアクティビティ: LLM呼び出し中
- 完了予測: 約 10 分後
- UI: {{WORKFLOW_UI_URL}}/runs/{{run_id}}
```

### 成功時（承認待ち）

```
[workflow:run]

Run ID: {{run_id}}
ワークフロー: {{workflow_type}}
ステータス: paused (承認待ち)
開始時刻: 2025-01-01 12:00:00

[工程進捗]
┌─────────┬────────────┬──────────┬────────────┐
│ Step    │ Status     │ Duration │ Updated    │
├─────────┼────────────┼──────────┼────────────┤
│ Step 1  │ ✓ completed│ 1m 20s   │ 12:01:20   │
│ Step 2  │ ✓ completed│ 2m 10s   │ 12:03:30   │
│ Step 3A │ ✓ completed│ 3m 00s   │ 12:06:30   │
│ Step 3B │ ✓ completed│ 2m 45s   │ 12:06:15   │
│ Step 3C │ ✓ completed│ 2m 30s   │ 12:06:00   │
│ Review  │ ⏸ waiting  │ -        │ -          │
└─────────┴────────────┴──────────┴────────────┘

[承認待ち]
工程 3（構成案/詳細化/タイトル案）の結果を確認してください。

[次のステップ]
- /workflow:approve {{run_id}} で承認
- /workflow:artifacts {{run_id}} --step step3 で中間成果物を確認
```

### 失敗時

```
[workflow:run]

Run ID: {{run_id}}
ワークフロー: {{workflow_type}}
ステータス: failed
開始時刻: 2025-01-01 12:00:00
終了時刻: 2025-01-01 12:05:30

[工程進捗]
┌─────────┬────────────┬──────────┬────────────┐
│ Step    │ Status     │ Duration │ Updated    │
├─────────┼────────────┼──────────┼────────────┤
│ Step 1  │ ✓ completed│ 1m 20s   │ 12:01:20   │
│ Step 2  │ ✗ failed   │ 4m 10s   │ 12:05:30   │
│ Step 3  │ - skipped  │ -        │ -          │
└─────────┴────────────┴──────────┴────────────┘

[エラー詳細]
工程: Step 2
エラー: LLM API rate limit exceeded
リトライ回数: 3/3
スタックトレース: (--verbose で表示)

[推奨アクション]
1. /dev:logs で詳細ログを確認
2. API レート制限を確認
3. /workflow:new で再実行（自動リトライ上限）
```

---

## 実装詳細

### API 経由

```bash
{{API_STATUS_COMMAND}}
```

<!-- 使用例（Temporal）:
```bash
# Temporal CLI 経由
temporal workflow describe --workflow-id {{run_id}}

# API 経由
curl http://localhost:8000/api/runs/{{run_id}} \
  -H "Authorization: Bearer $TOKEN"
```
-->

### リアルタイム監視

```bash
{{WATCH_COMMAND}}
```

<!-- 使用例:
```bash
# WebSocket 経由
wscat -c ws://localhost:8000/ws/runs/{{run_id}}

# ポーリング
watch -n 5 'curl -s http://localhost:8000/api/runs/{{run_id}} | jq'
```
-->

---

## 前提条件

- {{ORCHESTRATOR}} が稼働中
- 有効な認証トークン
- 指定した run_id が存在

---

## 関連コマンド

| コマンド | 説明 |
|----------|------|
| `/workflow:new` | 新規実行開始 |
| `/workflow:approve` | 承認待ち工程の承認 |
| `/workflow:artifacts` | 成果物の取得 |
| `/dev:logs` | サービスログ確認 |

---

## 手動実行

コマンドを使わずに手動で実行する場合:

```bash
# {{ORCHESTRATOR}} CLI
{{MANUAL_DESCRIBE_COMMAND}}

# API 直接呼び出し
{{MANUAL_API_STATUS_COMMAND}}
```

---

## 変数一覧

| 変数名 | 説明 | 必須 |
| ------ | ---- | ---- |
| `{{ORCHESTRATOR}}` | オーケストレーター名 | YES |
| `{{WORKFLOW_FRAMEWORK}}` | ワークフローフレームワーク | YES |
| `{{EXECUTION_STEPS}}` | 実行ステップ | YES |
| `{{API_STATUS_COMMAND}}` | API 経由のステータス取得コマンド | YES |
| `{{WATCH_COMMAND}}` | リアルタイム監視コマンド | YES |
| `{{WORKFLOW_UI_URL}}` | ワークフロー UI の URL | YES |
| `{{MANUAL_DESCRIBE_COMMAND}}` | 手動 CLI コマンド | YES |
| `{{MANUAL_API_STATUS_COMMAND}}` | 手動 API コマンド | YES |
