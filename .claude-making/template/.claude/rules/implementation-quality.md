# 実装品質保護ルール

> 形骸化した実装を防止するルール

---

## 禁止事項

### ハードコード

```
❌ 禁止:
- テスト期待値をそのまま return する
- 特定の入力に対してのみ動作する実装
- マジックナンバーの埋め込み（意味のある定数化なしに）
```

例（禁止）:
```python
def calculate_tax(amount):
    return 10  # テストが expect(calculate_tax(100)).toBe(10) だったため
```

### スタブ/空実装

```
❌ 禁止:
- pass のみの関数
- TODO コメントだけの実装
- NotImplementedError を投げるだけの実装（一時的なものも含む）
- 常に固定値を返す実装
```

例（禁止）:
```python
def process_data(data):
    pass  # TODO: implement later

def validate(input):
    return True  # always passes
```

### テスト期待値のコピペ

```
❌ 禁止:
- テストファイルから期待値をコピーして実装に貼り付け
- テストを通すためだけの条件分岐
```

---

## 正しい実装のチェックリスト

### 1. 一般性の確認

```
✅ 確認事項:
- テストケース以外の入力でも正しく動作するか
- エッジケース（null, 空, 境界値）を考慮しているか
- 将来の拡張に対応できる設計か
```

### 2. ロジックの妥当性

```
✅ 確認事項:
- 仕様に基づいたロジックになっているか
- 計算式や変換ルールが正しいか
- 副作用が適切に管理されているか
```

### 3. エラーハンドリング

```
✅ 確認事項:
- 異常系の処理が実装されているか
- エラーメッセージが適切か
- リソースの解放が確実か
```

---

## 実装完了の定義

以下をすべて満たすこと：

```
1. すべてのテストが通る
2. テストケース以外の入力でも正しく動作する
3. ハードコードや固定値がない
4. TODO/FIXME が残っていない
5. 型アノテーションが適切（Python/TypeScript）
6. lint エラーがない
```

---

## 疑わしい実装パターン

以下のパターンが見られた場合は再検討：

```
⚠️ 要確認:
- if/switch で入力値を直接比較して固定値を返す
- テストファイルと実装ファイルで同じ数値/文字列が出現
- 関数本体が1行で return のみ（getter以外）
- 引数を一切使わない関数
```

---

## 報告が必要なケース

```
⚠️ 親エージェントに報告:
- 仕様が不明確で正しい実装が判断できない
- テストと仕様が矛盾している
- 既存コードとの整合性が取れない
```
