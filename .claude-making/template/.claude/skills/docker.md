---
name: docker
description: Docker ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ãƒ»åœæ­¢ãƒ»ãƒ­ã‚°ç¢ºèªãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’çµ±åˆç®¡ç†ã™ã‚‹
---

# docker

> Docker æ“ä½œã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è‡ªå‹•åŒ–ã‚¹ã‚­ãƒ«

---

## ä½¿ç”¨æ–¹æ³•

```bash
/docker <action> [services] [options]
```

---

## ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|------|-----------|
| `action` | æ“ä½œç¨®åˆ¥ï¼ˆå¿…é ˆï¼‰ | - |
| `services` | å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹åï¼ˆè¤‡æ•°å¯ï¼‰ | å…¨ã‚µãƒ¼ãƒ“ã‚¹ |
| `--no-cache` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ã§ãƒ“ãƒ«ãƒ‰ | false |
| `--all` | å…¨ãƒªã‚½ãƒ¼ã‚¹ã‚’å¯¾è±¡ï¼ˆpruneæ™‚ï¼‰ | false |
| `--follow` | ãƒ­ã‚°ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ | false |
| `--tail <n>` | æœ«å°¾nè¡Œã®ã¿è¡¨ç¤º | 100 |
| `--since <duration>` | æŒ‡å®šæ™‚é–“ä»¥é™ã®ãƒ­ã‚° | - |

---

## action ä¸€è¦§

| action | èª¬æ˜ |
|--------|------|
| `start` | ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹• |
| `stop` | ã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢ |
| `health` | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ |
| `logs` | ãƒ­ã‚°ã‚’è¡¨ç¤º |
| `troubleshoot` | å•é¡Œè¨ºæ–­ |
| `reset` | å®Œå…¨ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼‰ |
| `build` | ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å†ãƒ“ãƒ«ãƒ‰ |
| `prune` | æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ |

---

## ä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
/docker start

# å…¨ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
/docker stop

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
/docker health

# å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°ã‚’è¡¨ç¤º
/docker logs

# å•é¡Œè¨ºæ–­
/docker troubleshoot

# å®Œå…¨ãƒªã‚»ãƒƒãƒˆï¼ˆãƒœãƒªãƒ¥ãƒ¼ãƒ å«ã‚€ï¼‰
/docker reset
```

### ã‚µãƒ¼ãƒ“ã‚¹æŒ‡å®š

```bash
# api ã¨ worker ã®ã¿èµ·å‹•
/docker start api worker

# worker ã®ã¿åœæ­¢
/docker stop worker

# api ã®ãƒ­ã‚°ã‚’è¡¨ç¤º
/docker logs api

# ui ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å†ãƒ“ãƒ«ãƒ‰
/docker build ui

# api ã¨ worker ã‚’å†ãƒ“ãƒ«ãƒ‰
/docker build api worker
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³çµ„ã¿åˆã‚ã›

```bash
# api ã®ãƒ­ã‚°ã‚’ãƒ•ã‚©ãƒ­ãƒ¼
/docker logs api --follow

# ç›´è¿‘50è¡Œã®ãƒ­ã‚°ã‚’è¡¨ç¤º
/docker logs api --tail 50

# éå»10åˆ†é–“ã®ãƒ­ã‚°ã‚’è¡¨ç¤º
/docker logs --since 10m

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ã§ãƒ“ãƒ«ãƒ‰
/docker build api --no-cache

# å…¨æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ï¼ˆãƒœãƒªãƒ¥ãƒ¼ãƒ å«ã‚€ï¼‰
/docker prune --all
```

---

## å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
1. ã‚ªãƒ—ã‚·ãƒ§ãƒ³è§£æ
   â”œâ”€ action åˆ¤å®šï¼ˆstart / stop / health / logs / troubleshoot / reset / build / pruneï¼‰
   â”œâ”€ services åˆ¤å®šï¼ˆæŒ‡å®šãªã—ã®å ´åˆã¯å…¨ã‚µãƒ¼ãƒ“ã‚¹ï¼‰
   â””â”€ options åˆ¤å®šï¼ˆno_cache / all / follow / tail / sinceï¼‰

2. @docker-manager ã‚’å‘¼ã³å‡ºã—
   å…¥åŠ›:
     action: {action}
     services: {services}
     options:
       no_cache: {no_cache}
       all: {all}
       follow: {follow}
       tail: {tail}
       since: {since}

3. çµæœã‚’è¡¨ç¤º
   â”œâ”€ status: success / warning / error
   â”œâ”€ message: æ“ä½œçµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
   â”œâ”€ details: è©³ç´°æƒ…å ±ï¼ˆã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹/ãƒ­ã‚°å†…å®¹/è¨ºæ–­çµæœï¼‰
   â””â”€ recommendation: æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ï¼‰

4. å¾Œç¶šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
   â””â”€ ä¾‹: èµ·å‹•å¾Œã« health ãƒã‚§ãƒƒã‚¯ã‚’æ¨å¥¨
```

---

## å‡ºåŠ›å½¢å¼

### æˆåŠŸæ™‚ï¼ˆsuccessï¼‰

```
[start]
----------------------------------------
Docker ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•å®Œäº†

èµ·å‹•ã‚µãƒ¼ãƒ“ã‚¹:
  postgres    : running (port 5432)
  minio       : running (port 9000, 9001)
  temporal    : running (port 7233)
  temporal-ui : running (port 8080)
  api         : running (port 8000)
  worker      : running
  ui          : running (port 3000)

å…¨ 7 ã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£å¸¸ã«èµ·å‹•ã—ã¾ã—ãŸã€‚

ğŸ’¡ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯: /docker health
----------------------------------------
```

### è­¦å‘Šæ™‚ï¼ˆwarningï¼‰

```
[health]
----------------------------------------
Docker ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Œäº†

ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹:
  postgres    : healthy
  minio       : healthy
  temporal    : healthy
  temporal-ui : healthy
  api         : unhealthy (health check failed)
  worker      : running (no health check)
  ui          : healthy

âš ï¸ ä¸€éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

è©³ç´°:
  api: Health check failed - connection refused on /health

ğŸ’¡ æ¨å¥¨: /docker logs api --tail 50 ã§ãƒ­ã‚°ã‚’ç¢ºèª
ğŸ’¡ æ¨å¥¨: /docker troubleshoot ã§è©³ç´°è¨ºæ–­
----------------------------------------
```

### ã‚¨ãƒ©ãƒ¼æ™‚ï¼ˆerrorï¼‰

```
[start]
----------------------------------------
Docker ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ã‚¨ãƒ©ãƒ¼

ã‚¨ãƒ©ãƒ¼:
  api: Error response from daemon: port 8000 already in use

å¤±æ•—ã‚µãƒ¼ãƒ“ã‚¹:
  api         : error

èµ·å‹•æ¸ˆã¿ã‚µãƒ¼ãƒ“ã‚¹:
  postgres    : running
  minio       : running
  temporal    : running

ğŸš¨ è§£æ±ºç­–:
  1. ãƒãƒ¼ãƒˆ 8000 ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª:
     lsof -i :8000
  2. ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ã™ã‚‹ã‹ã€.env ã§ API_PORT ã‚’å¤‰æ›´

ğŸ’¡ å†è©¦è¡Œ: /docker start api
----------------------------------------
```

---

## action è©³ç´°

### start

ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```bash
/docker start                  # å…¨ã‚µãƒ¼ãƒ“ã‚¹
/docker start postgres minio   # æŒ‡å®šã‚µãƒ¼ãƒ“ã‚¹ã®ã¿
```

å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰: `docker compose up -d [services]`

### stop

ã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢ã—ã¾ã™ã€‚

```bash
/docker stop                   # å…¨ã‚µãƒ¼ãƒ“ã‚¹
/docker stop worker            # æŒ‡å®šã‚µãƒ¼ãƒ“ã‚¹ã®ã¿
```

å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰: `docker compose stop [services]`

### health

å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
/docker health
```

ãƒã‚§ãƒƒã‚¯å†…å®¹:
- ã‚³ãƒ³ãƒ†ãƒŠçŠ¶æ…‹ï¼ˆrunning / exited / restartingï¼‰
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çµæœï¼ˆhealthy / unhealthy / startingï¼‰
- ãƒãƒ¼ãƒˆåˆ°é”æ€§
- ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³ï¼ˆCPU / ãƒ¡ãƒ¢ãƒªï¼‰

### logs

ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```bash
/docker logs                   # å…¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆæœ«å°¾100è¡Œï¼‰
/docker logs api               # api ã®ã¿
/docker logs api --follow      # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
/docker logs api --tail 50     # æœ«å°¾50è¡Œ
/docker logs --since 10m       # éå»10åˆ†é–“
```

å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰: `docker compose logs [options] [services]`

### troubleshoot

å•é¡Œè¨ºæ–­ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
/docker troubleshoot
```

è¨ºæ–­å†…å®¹:
- Docker ãƒ‡ãƒ¼ãƒ¢ãƒ³çŠ¶æ…‹
- ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š
- ã‚³ãƒ³ãƒ†ãƒŠã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
- ãƒªã‚½ãƒ¼ã‚¹ç«¶åˆ
- ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯

### reset

ç’°å¢ƒã‚’å®Œå…¨ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ï¼ˆãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚’å«ã‚€ï¼‰ã€‚

```bash
/docker reset
```

å®Ÿè¡Œå†…å®¹:
1. å…¨ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢
2. å…¨ã‚³ãƒ³ãƒ†ãƒŠå‰Šé™¤
3. ãƒœãƒªãƒ¥ãƒ¼ãƒ å‰Šé™¤ï¼ˆpostgres / minio ãƒ‡ãƒ¼ã‚¿å«ã‚€ï¼‰
4. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å‰Šé™¤

âš ï¸ **è­¦å‘Š**: ã“ã®æ“ä½œã¯å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

### build

ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å†ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚

```bash
/docker build                  # å…¨ã‚µãƒ¼ãƒ“ã‚¹
/docker build api              # api ã®ã¿
/docker build ui --no-cache    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—
```

å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰: `docker compose build [--no-cache] [services]`

### prune

æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

```bash
/docker prune                  # åŸºæœ¬ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
/docker prune --all            # å…¨æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ï¼ˆãƒœãƒªãƒ¥ãƒ¼ãƒ å«ã‚€ï¼‰
```

å‰Šé™¤å¯¾è±¡:
- åœæ­¢ã‚³ãƒ³ãƒ†ãƒŠ
- æœªä½¿ç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
- ãƒ€ãƒ³ã‚°ãƒªãƒ³ã‚°ã‚¤ãƒ¡ãƒ¼ã‚¸
- `--all`: æœªä½¿ç”¨ãƒœãƒªãƒ¥ãƒ¼ãƒ ã€æœªä½¿ç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸

---

## ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§

| ã‚µãƒ¼ãƒ“ã‚¹ | ãƒãƒ¼ãƒˆ | èª¬æ˜ |
|---------|--------|------|
| `postgres` | 5432 | PostgreSQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ |
| `minio` | 9000, 9001 | ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ |
| `temporal` | 7233 | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ |
| `temporal-ui` | 8080 | Temporal ç®¡ç†UI |
| `api` | 8000 | FastAPI ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ |
| `worker` | - | Temporal Worker |
| `ui` | 3000 | Next.js ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ |

### ã‚µãƒ¼ãƒ“ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—

```bash
# ã‚¤ãƒ³ãƒ•ãƒ©ã®ã¿èµ·å‹•ï¼ˆé–‹ç™ºæ™‚æ¨å¥¨ï¼‰
/docker start postgres minio temporal temporal-ui

# ã‚¢ãƒ—ãƒªã®ã¿èµ·å‹•
/docker start api worker ui

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã¿
/docker start postgres minio temporal api worker
```

---

## é–¢é€£

- **@docker-manager**: ã“ã®ã‚¹ã‚­ãƒ«ãŒå‘¼ã³å‡ºã™ agent
- **/dev:up**: é–‹ç™ºç’°å¢ƒèµ·å‹•ï¼ˆã‚¤ãƒ³ãƒ•ãƒ© + ã‚¢ãƒ—ãƒªï¼‰
- **/dev:down**: é–‹ç™ºç’°å¢ƒåœæ­¢
- **/dev:smoke**: ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆï¼ˆç’°å¢ƒãƒã‚§ãƒƒã‚¯å«ã‚€ï¼‰

---

## æ¨å¥¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### é–‹ç™ºé–‹å§‹æ™‚

```
1. /docker start
   â””â”€ å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•

2. /docker health
   â””â”€ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

3. é–‹ç™ºä½œæ¥­

4. /docker logs api --follow
   â””â”€ ãƒ­ã‚°ç›£è¦–ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
```

### å•é¡Œç™ºç”Ÿæ™‚

```
1. /docker health
   â””â”€ çŠ¶æ…‹ç¢ºèª

2. /docker troubleshoot
   â””â”€ å•é¡Œè¨ºæ–­

3. /docker logs <service> --tail 100
   â””â”€ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª

4. å¿…è¦ã«å¿œã˜ã¦:
   â”œâ”€ /docker stop <service> && /docker start <service>  # å†èµ·å‹•
   â”œâ”€ /docker build <service> --no-cache                 # å†ãƒ“ãƒ«ãƒ‰
   â””â”€ /docker reset                                       # å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
```

### ä½œæ¥­çµ‚äº†æ™‚

```
1. /docker stop
   â””â”€ å…¨ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢

2. ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰/docker prune
   â””â”€ æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤
```
