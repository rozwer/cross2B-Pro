============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.2, pluggy-1.6.0 -- /home/rozwer/案件/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/rozwer/案件
configfile: pyproject.toml
plugins: asyncio-1.3.0, anyio-4.12.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 76 items

tests/unit/llm/test_anthropic.py::TestAnthropicClientInit::test_init_with_api_key PASSED [  1%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientInit::test_init_with_env_var PASSED [  2%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientInit::test_init_without_api_key_raises PASSED [  3%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientInit::test_init_with_unsupported_model_raises PASSED [  5%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientInit::test_init_with_supported_models[claude-sonnet-4-20250514] PASSED [  6%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientInit::test_init_with_supported_models[claude-opus-4-20250514] PASSED [  7%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientInit::test_init_with_supported_models[claude-3-5-sonnet-20241022] PASSED [  9%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientInit::test_init_with_supported_models[claude-3-5-haiku-20241022] PASSED [ 10%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientGenerate::test_generate_success PASSED [ 11%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientGenerate::test_generate_auth_error_raises_non_retryable PASSED [ 13%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientGenerate::test_generate_rate_limit_retries PASSED [ 14%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientGenerate::test_generate_connection_error_retries PASSED [ 15%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientGenerate::test_generate_server_error_retries PASSED [ 17%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientGenerate::test_generate_client_error_no_retry PASSED [ 18%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientGenerateJson::test_generate_json_success PASSED [ 19%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientGenerateJson::test_generate_json_no_tool_use_raises_validation_error PASSED [ 21%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientMessageConversion::test_convert_user_messages PASSED [ 22%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientMessageConversion::test_convert_assistant_messages PASSED [ 23%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientMessageConversion::test_convert_system_messages_skipped PASSED [ 25%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientMessageConversion::test_convert_unknown_role_to_user PASSED [ 26%]
tests/unit/llm/test_anthropic.py::TestAnthropicClientMessageConversion::test_convert_mixed_messages PASSED [ 27%]
tests/unit/llm/test_anthropic.py::TestErrorCategories::test_retryable_error_has_correct_category PASSED [ 28%]
tests/unit/llm/test_anthropic.py::TestErrorCategories::test_non_retryable_error_has_correct_category PASSED [ 30%]
tests/unit/llm/test_anthropic.py::TestErrorCategories::test_validation_error_has_correct_category PASSED [ 31%]
tests/unit/llm/test_anthropic.py::TestNoAutoSwitching::test_no_auto_switch_patterns_in_code PASSED [ 32%]
tests/unit/llm/test_anthropic.py::TestNoAutoSwitching::test_retry_uses_same_model PASSED [ 34%]
tests/unit/llm/test_anthropic.py::TestNoAutoSwitching::test_model_is_immutable_after_init PASSED [ 35%]
tests/unit/llm/test_gemini.py::TestTokenUsage::test_total PASSED         [ 36%]
tests/unit/llm/test_gemini.py::TestTokenUsage::test_immutable PASSED     [ 38%]
tests/unit/llm/test_gemini.py::TestLLMResponse::test_create PASSED       [ 39%]
tests/unit/llm/test_gemini.py::TestLLMResponse::test_with_grounding_metadata PASSED [ 40%]
tests/unit/llm/test_gemini.py::TestLLMRequestConfig::test_defaults PASSED [ 42%]
tests/unit/llm/test_gemini.py::TestLLMRequestConfig::test_custom_values PASSED [ 43%]
tests/unit/llm/test_gemini.py::TestGeminiConfig::test_defaults PASSED    [ 44%]
tests/unit/llm/test_gemini.py::TestGeminiConfig::test_grounding_enabled PASSED [ 46%]
tests/unit/llm/test_gemini.py::TestGeminiClientInitialization::test_missing_api_key PASSED [ 47%]
tests/unit/llm/test_gemini.py::TestGeminiClientInitialization::test_missing_package PASSED [ 48%]
tests/unit/llm/test_gemini.py::TestGeminiClientInitialization::test_successful_initialization PASSED [ 50%]
tests/unit/llm/test_gemini.py::TestGeminiClientInitialization::test_custom_model PASSED [ 51%]
tests/unit/llm/test_gemini.py::TestGeminiClientProperties::test_provider_name PASSED [ 52%]
tests/unit/llm/test_gemini.py::TestGeminiClientProperties::test_default_model PASSED [ 53%]
tests/unit/llm/test_gemini.py::TestGeminiClientProperties::test_available_models PASSED [ 55%]
tests/unit/llm/test_gemini.py::TestGeminiClientGrounding::test_grounding_disabled_by_default PASSED [ 56%]
tests/unit/llm/test_gemini.py::TestGeminiClientGrounding::test_enable_grounding PASSED [ 57%]
tests/unit/llm/test_gemini.py::TestGeminiClientGrounding::test_grounding_with_config PASSED [ 59%]
tests/unit/llm/test_gemini.py::TestGeminiClientGenerate::test_generate_success PASSED [ 60%]
tests/unit/llm/test_gemini.py::TestGeminiClientGenerate::test_generate_with_llm_message PASSED [ 61%]
tests/unit/llm/test_gemini.py::TestGeminiClientGenerate::test_generate_with_metadata PASSED [ 63%]
tests/unit/llm/test_gemini.py::TestGeminiClientGenerateJSON::test_generate_json_success PASSED [ 64%]
tests/unit/llm/test_gemini.py::TestGeminiClientGenerateJSON::test_generate_json_parse_error PASSED [ 65%]
tests/unit/llm/test_gemini.py::TestGeminiClientHealthCheck::test_health_check_success PASSED [ 67%]
tests/unit/llm/test_gemini.py::TestGeminiClientHealthCheck::test_health_check_failure PASSED [ 68%]
tests/unit/llm/test_gemini.py::TestGeminiClientErrorHandling::test_authentication_error PASSED [ 69%]
tests/unit/llm/test_gemini.py::TestGeminiClientErrorHandling::test_rate_limit_error PASSED [ 71%]
tests/unit/llm/test_gemini.py::TestErrorCategory::test_retryable PASSED  [ 72%]
tests/unit/llm/test_gemini.py::TestErrorCategory::test_non_retryable PASSED [ 73%]
tests/unit/llm/test_gemini.py::TestErrorCategory::test_validation_fail PASSED [ 75%]
tests/unit/llm/test_gemini.py::TestNoFallback::test_no_fallback_model_in_code PASSED [ 76%]
tests/unit/llm/test_gemini.py::TestNoFallback::test_single_provider PASSED [ 77%]
tests/unit/llm/test_openai.py::TestOpenAIClientInit::test_init_with_env_key PASSED [ 78%]
tests/unit/llm/test_openai.py::TestOpenAIClientInit::test_init_with_explicit_key PASSED [ 80%]
tests/unit/llm/test_openai.py::TestOpenAIClientInit::test_init_with_custom_model PASSED [ 81%]
tests/unit/llm/test_openai.py::TestOpenAIClientInit::test_init_without_key_raises_error PASSED [ 82%]
tests/unit/llm/test_openai.py::TestOpenAIClientGenerate::test_generate_success PASSED [ 84%]
tests/unit/llm/test_openai.py::TestOpenAIClientGenerate::test_generate_rate_limit_retry PASSED [ 85%]
tests/unit/llm/test_openai.py::TestOpenAIClientGenerate::test_generate_rate_limit_max_retries PASSED [ 86%]
tests/unit/llm/test_openai.py::TestOpenAIClientGenerate::test_generate_auth_error_no_retry PASSED [ 88%]
tests/unit/llm/test_openai.py::TestOpenAIClientGenerate::test_generate_bad_request_no_retry PASSED [ 89%]
tests/unit/llm/test_openai.py::TestOpenAIClientGenerate::test_generate_connection_error_retry PASSED [ 90%]
tests/unit/llm/test_openai.py::TestOpenAIClientGenerateJson::test_generate_json_success PASSED [ 92%]
tests/unit/llm/test_openai.py::TestOpenAIClientGenerateJson::test_generate_json_invalid_json PASSED [ 93%]
tests/unit/llm/test_openai.py::TestErrorClassification::test_llm_error_is_retryable PASSED [ 94%]
tests/unit/llm/test_openai.py::TestErrorClassification::test_llm_error_not_retryable PASSED [ 96%]
tests/unit/llm/test_openai.py::TestErrorClassification::test_validation_error_not_retryable PASSED [ 97%]
tests/unit/llm/test_openai.py::TestNoFallback::test_no_fallback_model_in_code PASSED [ 98%]
tests/unit/llm/test_openai.py::TestNoFallback::test_no_alternative_provider_in_code PASSED [100%]

============================== 76 passed in 5.34s ==============================
