{
  "session_id": "E",
  "phase": "5",
  "title": "工程-1（絶対条件ヒアリングフォーム）既存スキーマ拡張",
  "description": "既存のarticle_hearing.pyスキーマを活用し、テンプレート保存・再利用機能を追加。ワークフロー開始前の入力フォームを完成。",
  "dependencies": [],
  "estimated_files": 6,

  "existing_schema": {
    "file": "apps/api/schemas/article_hearing.py",
    "status": "実装済み",
    "sections": [
      "BusinessInput: 事業内容とターゲット",
      "KeywordInput: キーワード選定",
      "StrategyInput: 記事戦略",
      "WordCountInput: 文字数設定",
      "CTAInput: CTA設定",
      "confirmed: 最終確認"
    ],
    "note": "ArticleHearingInputが既に包括的な6セクション構造を持つ"
  },

  "tasks": [
    {
      "id": "E-1",
      "type": "schema_extension",
      "description": "既存article_hearing.pyにテンプレート機能を追加",
      "file": "apps/api/schemas/article_hearing.py",
      "details": {
        "additions": {
          "HearingTemplate": {
            "id": "UUID",
            "tenant_id": "UUID",
            "name": "string (テンプレート名)",
            "description": "string (説明)",
            "data": "ArticleHearingInput (confirmed除く)",
            "created_at": "datetime",
            "updated_at": "datetime"
          }
        },
        "note": "既存のArticleHearingInputはそのまま使用"
      }
    },
    {
      "id": "E-2",
      "type": "database",
      "description": "hearing_templatesテーブル追加",
      "file": "apps/api/models/hearing.py",
      "details": {
        "table_name": "hearing_templates",
        "columns": [
          "id: UUID PRIMARY KEY",
          "tenant_id: UUID NOT NULL",
          "name: VARCHAR(255) NOT NULL",
          "description: TEXT",
          "data: JSONB NOT NULL",
          "created_at: TIMESTAMP DEFAULT NOW()",
          "updated_at: TIMESTAMP DEFAULT NOW()"
        ],
        "indexes": [
          "tenant_id",
          "name"
        ],
        "constraints": [
          "UNIQUE (tenant_id, name)"
        ]
      }
    },
    {
      "id": "E-3",
      "type": "api",
      "description": "ヒアリングテンプレートCRUD API",
      "file": "apps/api/routers/hearing.py",
      "details": {
        "endpoints": [
          "POST /api/hearing/templates - テンプレート保存",
          "GET /api/hearing/templates - テナントのテンプレート一覧",
          "GET /api/hearing/templates/{id} - テンプレート取得",
          "PUT /api/hearing/templates/{id} - テンプレート更新",
          "DELETE /api/hearing/templates/{id} - テンプレート削除"
        ],
        "security": {
          "tenant_scope": "required",
          "audit_log": "create/update/delete アクション記録"
        }
      }
    },
    {
      "id": "E-4",
      "type": "migration",
      "description": "DBマイグレーション作成",
      "file": "apps/api/migrations/xxx_add_hearing_templates_table.py",
      "details": {
        "action": "CREATE TABLE hearing_templates"
      }
    },
    {
      "id": "E-5",
      "type": "ui_enhancement",
      "description": "既存ヒアリングウィザードにテンプレート機能追加",
      "file": "apps/ui/src/components/hearing/ArticleHearingWizard.tsx",
      "details": {
        "additions": [
          "テンプレート選択ドロップダウン（ステップ0として追加）",
          "現在の入力をテンプレートとして保存ボタン",
          "テンプレート管理モーダル"
        ],
        "note": "既存のウィザードUIを拡張"
      }
    },
    {
      "id": "E-6",
      "type": "test",
      "description": "テンプレート機能のテスト",
      "file": "tests/integration/test_hearing_templates.py",
      "details": {
        "test_cases": [
          "API: テンプレートCRUD",
          "テナント分離: 他テナントのテンプレートにアクセス不可",
          "UI: テンプレート選択でフォームが自動入力される",
          "統合: テンプレートからワークフロー開始"
        ]
      }
    }
  ],

  "output_spec": {
    "description": "工程-1はテンプレートDB + run開始時のArticleHearingInput",
    "storage": {
      "templates": "hearing_templatesテーブル",
      "run_input": "runsテーブルのinput_data (JSONB)"
    },
    "format": {
      "template": {
        "id": "UUID",
        "tenant_id": "UUID",
        "name": "string",
        "description": "string",
        "data": "ArticleHearingInput構造（confirmed除く）",
        "created_at": "datetime",
        "updated_at": "datetime"
      }
    }
  },

  "acceptance_criteria": [
    "既存ArticleHearingInputスキーマをそのまま使用",
    "テンプレートとして保存・再利用可能",
    "テンプレート選択でフォームが自動入力",
    "テナント分離が保証される",
    "既存のワークフロー開始フローに影響なし"
  ],

  "notes": [
    "工程-1は「前提条件設定」フェーズであり、ワークフロー実行外",
    "既存のarticle_hearing.pyを最大限活用",
    "テンプレート機能は段階的に追加可能"
  ],

  "related_existing_files": [
    "apps/api/schemas/article_hearing.py - 既存スキーマ（変更済み）",
    "apps/ui/src/components/hearing/ - 既存UIコンポーネント群"
  ]
}
