# SEO Article Auto-Generator

## Design Document / 設計書

**Version:** 1.0
**Date:** 2026-01-21
**Author:** Development Team

---

## 1. ツール名 / Tool Name

**SEO Article Auto-Generator**
（SEO記事自動生成システム）

---

## 2. システム概要 / System Overview

本システムは、キーワードを入力として受け取り、競合分析・戦略立案・本文生成を自動で行い、SEO最適化された記事を4バリエーション出力するワークフローシステムです。

### 主な特徴

- **12工程の自動化ワークフロー**: キーワード選定から最終HTML出力まで
- **Human-in-the-loop**: 重要な工程で人間の承認を挟む設計
- **マルチテナント対応**: 複数顧客のデータを安全に分離
- **リアルタイム進捗表示**: WebSocketによる即座のフィードバック

---

## 3. システムフロー図 / System Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SEO Article Auto-Generator                          │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   Frontend   │────>│   FastAPI    │────>│   Temporal   │────>│   LangGraph  │
│  (Next.js)   │<────│  (Backend)   │<────│  (Workflow)  │<────│    (LLM)     │
└──────────────┘     └──────────────┘     └──────────────┘     └──────────────┘
       │                    │                    │                    │
       │                    v                    v                    v
       │             ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
       │             │  PostgreSQL  │     │    MinIO     │     │  Gemini /    │
       │             │     (DB)     │     │  (Storage)   │     │   Claude     │
       └────────────>│              │     │              │     │              │
                     └──────────────┘     └──────────────┘     └──────────────┘


【データフロー詳細】

        ┌─────────────────────────────────────────────────────────────────┐
        │                      ワークフロー全体図                          │
        └─────────────────────────────────────────────────────────────────┘

        [キーワード入力]
              │
              v
   ┌──────────────────┐
   │  工程0: KW選定    │ ──> Gemini API
   └──────────────────┘
              │
              v
   ┌──────────────────┐
   │ 工程1: 競合取得   │ ──> SERP API / Scraping
   └──────────────────┘
              │
              v
   ┌──────────────────┐
   │ 工程1.5: 品質評価 │ ──> Gemini API
   └──────────────────┘
              │
              v
   ┌──────────────────┐
   │  工程2: 検証      │
   └──────────────────┘
              │
              v
   ┌──────────────────────────────────────────────┐
   │           工程3A / 3B / 3C（並列）            │
   │  ┌─────────┐  ┌─────────┐  ┌─────────┐      │
   │  │クエリ分析│  │共起語抽出│  │競合分析 │      │
   │  └─────────┘  └─────────┘  └─────────┘      │
   └──────────────────────────────────────────────┘
              │
              v
   ╔═══════════════════════════════════════════════╗
   ║            【承認待ち / Human Review】         ║
   ╚═══════════════════════════════════════════════╝
              │
              v
   ┌──────────────────┐
   │ 工程4: アウトライン│ ──> Claude API
   └──────────────────┘
              │
              v
   ┌──────────────────┐
   │ 工程5: 一次情報   │ ──> Web検索 / Gemini
   └──────────────────┘
              │
              v
   ┌──────────────────┐
   │ 工程6: 強化版     │ ──> Claude API
   └──────────────────┘
              │
              v
   ┌──────────────────┐
   │ 工程7A/7B: 本文   │ ──> Claude / Gemini
   └──────────────────┘
              │
              v
   ┌──────────────────┐
   │ 工程8: FAQ統合    │ ──> Gemini + Web
   └──────────────────┘
              │
              v
   ┌──────────────────┐
   │ 工程9: 最終ライト │ ──> Claude API
   └──────────────────┘
              │
              v
   ┌──────────────────┐
   │ 工程10: 4記事生成 │ ──> Claude API
   └──────────────────┘
              │
              v
   ┌──────────────────┐
   │ 工程11: 画像生成  │ ──> Gemini / 画像API
   └──────────────────┘
              │
              v
   ┌──────────────────┐
   │ 工程12: WP変換    │ ──> Claude API
   └──────────────────┘
              │
              v
        [4記事出力]
         (HTML/MD)
```

---

## 4. 画面イメージ / Screen Mockups

### 4.1 ダッシュボード（Run一覧）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  SEO Article Auto-Generator                                    [+ 新規作成] │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ID        │ キーワード      │ 状態            │ 工程    │ 更新日時   │   │
│  ├───────────┼─────────────────┼─────────────────┼─────────┼────────────┤   │
│  │ RUN-001   │ SEO対策 初心者  │ ● 完了          │ 12/12   │ 2026-01-21 │   │
│  │ RUN-002   │ コンテンツマーケ │ ◐ 承認待ち      │ 3/12    │ 2026-01-21 │   │
│  │ RUN-003   │ ブログ 書き方   │ ○ 実行中        │ 7/12    │ 2026-01-21 │   │
│  │ RUN-004   │ 記事作成 AI     │ ✕ 失敗          │ 5/12    │ 2026-01-20 │   │
│  └───────────┴─────────────────┴─────────────────┴─────────┴────────────┘   │
│                                                                             │
│  状態凡例:  ● 完了  ◐ 承認待ち  ○ 実行中  ✕ 失敗                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 Run詳細（ワークフロービュー）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  RUN-002: SEO対策 初心者                                         [承認] [却下] │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【ワークフロー進捗】                                                        │
│                                                                             │
│  ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────────────────────┐          │
│  │ KW  │──>│競合 │──>│評価 │──>│検証 │──>│ 3A   3B   3C       │          │
│  │ ●   │   │ ●   │   │ ●   │   │ ●   │   │ ●    ●    ●        │          │
│  └─────┘   └─────┘   └─────┘   └─────┘   └─────────────────────┘          │
│                                                     │                       │
│                                               ◐ 承認待ち                    │
│                                                     │                       │
│  ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   │                       │
│  │概要 │<──│強化 │<──│一次 │<──│ OL  │<──│HT   │<──┘                       │
│  │ ○   │   │ ○   │   │ ○   │   │ ○   │   │ ○   │                          │
│  └─────┘   └─────┘   └─────┘   └─────┘   └─────┘                          │
│      │                                                                      │
│      v                                                                      │
│  ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐                          │
│  │7A   │──>│7B   │──>│FAQ  │──>│Final│──>│4記事│                          │
│  │ ○   │   │ ○   │   │ ○   │   │ ○   │   │ ○   │                          │
│  └─────┘   └─────┘   └─────┘   └─────┘   └─────┘                          │
│                                               │                             │
│                                               v                             │
│                                          ┌─────┐   ┌─────┐                  │
│                                          │画像 │──>│ WP  │                  │
│                                          │ ○   │   │ ○   │                  │
│                                          └─────┘   └─────┘                  │
│                                                                             │
│  ● 完了  ◐ 承認待ち  ○ 未着手                                              │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  【工程3B: 共起語・関連KW抽出】                              [ダウンロード]   │
│  ─────────────────────────────────────────────────────────────────────────  │
│  抽出キーワード数: 45                                                        │
│  主要共起語: SEO, 検索順位, コンテンツ, Google, アルゴリズム                  │
│  関連KW: 初心者向けSEO, SEO基礎, 検索エンジン最適化                          │
│                                                                             │
│  出力: storage/tenant-001/run-002/step3b/output.json                        │
│  ハッシュ: sha256:a1b2c3d4...                                               │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.3 成果物プレビュー

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  成果物プレビュー: 記事1（メイン記事）                         [HTML] [MD]   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                                                                       │ │
│  │  # SEO対策 初心者向け完全ガイド【2026年最新版】                        │ │
│  │                                                                       │ │
│  │  ## 目次                                                              │ │
│  │  1. SEOとは？初心者にもわかる基礎知識                                 │ │
│  │  2. なぜSEO対策が重要なのか                                          │ │
│  │  3. 今日から始められる5つのSEO施策                                   │ │
│  │  4. よくある失敗と対策                                               │ │
│  │  5. まとめ                                                           │ │
│  │                                                                       │ │
│  │  ---                                                                  │ │
│  │                                                                       │ │
│  │  ## 1. SEOとは？初心者にもわかる基礎知識                              │ │
│  │                                                                       │ │
│  │  SEO（Search Engine Optimization）とは、Googleなどの検索エンジンで    │ │
│  │  自社サイトを上位表示させるための施策です。                            │ │
│  │                                                                       │ │
│  │  > 📊 データポイント: 検索結果1位のクリック率は約28.5%               │ │
│  │  > （出典: Backlinko 2025年調査）                                    │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  文字数: 5,234文字 | SEOスコア: 87/100 | 読了時間: 約8分                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 技術スタック / Technology Stack

### 5.1 アーキテクチャ構成

| レイヤー | 技術 | 役割 |
|---------|------|------|
| Frontend | Next.js (React) | UI/UX、リアルタイム表示 |
| Backend | FastAPI (Python) | REST API、認証 |
| Workflow | Temporal | ワークフロー実行管理 |
| AI Logic | LangGraph | LLMオーケストレーション |
| Database | PostgreSQL | メタデータ、監査ログ |
| Storage | MinIO | 成果物保存 |

### 5.2 使用するLLMサービス

| サービス | 用途 | 工程 |
|---------|------|------|
| **Google Gemini** | 分析・検索・自然な表現 | 工程0, 1.5, 3A-C, 5, 7B, 8 |
| **Anthropic Claude** | 構造化・統合・品質制御 | 工程4, 6, 6.5, 7A, 9, 10, 12 |

### 5.3 外部API連携

| サービス | 用途 |
|---------|------|
| SERP API | 検索結果取得 |
| Web Scraping | 競合記事本文取得 |
| 画像生成API | 記事内画像生成（工程11） |

---

## 6. データベース設計 / Database Schema

### 主要テーブル

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Database Schema                                │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌──────────────┐       ┌──────────────┐       ┌──────────────┐
  │   tenants    │       │     runs     │       │  artifacts   │
  ├──────────────┤       ├──────────────┤       ├──────────────┤
  │ id (PK)      │──┐    │ id (PK)      │──┐    │ id (PK)      │
  │ name         │  │    │ tenant_id(FK)│<─┘    │ run_id (FK)  │<─┐
  │ created_at   │  │    │ keyword      │       │ step         │  │
  └──────────────┘  │    │ status       │       │ output_path  │  │
                    │    │ current_step │       │ output_digest│  │
                    │    │ created_at   │       │ created_at   │  │
                    │    └──────────────┘───────└──────────────┘  │
                    │                                             │
                    │    ┌──────────────┐       ┌──────────────┐  │
                    │    │  audit_logs  │       │   prompts    │  │
                    │    ├──────────────┤       ├──────────────┤  │
                    └───>│ id (PK)      │       │ id (PK)      │  │
                         │ tenant_id(FK)│       │ step         │  │
                         │ run_id (FK)  │<──────│ version      │  │
                         │ action       │       │ content      │  │
                         │ actor        │       │ variables    │  │
                         │ timestamp    │       └──────────────┘  │
                         └──────────────┘                         │
                                                                  │
  ┌──────────────────────────────────────────────────────────────┘
  │
  │  Storage Path Convention:
  │  storage/{tenant_id}/{run_id}/{step}/output.json
  │
  └──────────────────────────────────────────────────────────────
```

---

## 7. セキュリティ設計 / Security Design

### 7.1 マルチテナント分離

- 全データアクセスは `tenant_id` でスコープ
- 物理的なDB分離を実施
- 越境アクセスの防止

### 7.2 認証・認可

- JWT トークンベース認証
- API キーは暗号化保存
- 平文ログ出力禁止

### 7.3 監査ログ

全ての重要操作を記録:
- ワークフロー開始/停止
- 承認/却下
- 成果物ダウンロード
- データ削除

---

## 8. 出力成果物 / Output Artifacts

### 工程別出力

| 工程 | 出力ファイル | 内容 |
|-----|-------------|------|
| 0 | `step0_keyword.json` | 選定キーワード |
| 1 | `step1_competitors.csv` | 競合記事一覧 |
| 1.5 | `step1_5_scored.json` | 品質スコア付き競合 |
| 3A | `step3a_query.json` | クエリ分析結果 |
| 3B | `step3b_keywords.json` | 共起語・関連KW |
| 3C | `step3c_competitor.json` | 競合分析結果 |
| 10 | `article_1-4.md/html` | 最終4記事 |
| 12 | `step12_wp.html` | WordPress形式 |

### 4記事バリエーション

| 記事 | タイプ | ターゲット |
|-----|-------|-----------|
| 1 | メイン記事 | 全読者向け |
| 2 | 初心者向け | 入門者 |
| 3 | 実践編 | 中級者 |
| 4 | まとめ | 要点把握 |

---

## 9. 非機能要件 / Non-Functional Requirements

| 項目 | 目標値 |
|-----|-------|
| 全工程所要時間 | 60分以内（承認待ち除く） |
| 同時実行数 | 10 run |
| システム稼働率 | 95%（月次） |
| データ保持期間 | 完了run: 1年、監査ログ: 3年 |

---

## 10. 今後の拡張計画 / Future Roadmap

1. **多言語対応**: 英語・中国語記事生成
2. **AI画像生成強化**: DALL-E / Midjourney統合
3. **WordPress自動投稿**: REST API連携
4. **分析ダッシュボード**: 生成記事のパフォーマンス追跡

---

**Document End**
