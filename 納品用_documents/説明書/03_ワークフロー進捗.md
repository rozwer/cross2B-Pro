# ワークフロー進捗・承認

> URL: http://localhost:3000/runs/{run_id}

記事生成の各工程の進捗確認と、承認操作を行う画面です。

---

## ワークフロー全体像

記事生成は以下の工程で進みます:

```
【半自動フロー】人間の確認あり
工程-1 → 0 → 1 → 1.5 → 2 → 3A/3B/3C（並列）
                                    ↓
                              [承認待ち] ← ★ ここで人間が確認
                                    ↓
【全自動フロー】一気通貫で自動実行
3.5 → 4 → 5 → 6 → 6.5 → 7A → 7B → 8 → 9 → 10 → 11 → 12
```

---

## 画面構成

### ワークフローグラフ

各工程がノード（箱）として表示され、進捗状況が色分けされます:

| 色 | 状態 |
|----|------|
| 🟢 緑 | 完了 |
| 🔵 青 | 実行中 |
| 🟡 黄 | 承認待ち |
| ⚪ グレー | 未実行 |
| 🔴 赤 | エラー |

### 工程詳細パネル

各工程のノードをクリックすると、右側に詳細パネルが表示されます:

- **出力内容**: その工程の実行結果（JSON, Markdown等）
- **実行時間**: 所要時間
- **使用モデル**: 使用されたAIモデル
- **コスト**: トークン使用量と概算コスト

---

## 承認操作（重要）

工程3A/3B/3Cが完了すると **承認待ち** 状態になります。この段階で人間が内容を確認し、続行するかどうかを判断します。

### 承認の手順

1. 承認待ちになると、画面上部に **承認ダイアログ** が表示されます
2. 工程3A（クエリ分析・ペルソナ）、3B（共起語・関連KW）、3C（競合分析）の出力を確認
3. 内容に問題がなければ **「承認」** をクリック
4. 修正が必要な場合は **「却下」** をクリック → 工程3が再実行されます

### 承認後の自動実行

承認すると、工程3.5〜12が全自動で実行されます。完了まで通常20〜40分程度かかります（キーワードの複雑さやAPIの応答速度により変動）。

---

## 各工程の概要

| 工程 | 名称 | AI | 説明 |
|------|------|----|------|
| -1 | ヒアリング | - | ウィザードで入力した内容 |
| 0 | キーワード選定 | Gemini | 最適なSEOキーワードを選定 |
| 1 | 競合記事取得 | Tool | Google検索上位の競合記事を取得 |
| 1.5 | 品質スコア | Gemini | 競合記事の品質を評価 |
| 2 | データ検証 | Gemini | 取得データの妥当性確認 |
| 3A | クエリ分析 | Gemini | 検索意図とペルソナ分析 |
| 3B | 共起語抽出 | Gemini | 関連キーワードの抽出（心臓部） |
| 3C | 競合分析 | Gemini | 競合との差別化戦略 |
| **承認** | | | **人間が内容を確認** |
| 3.5 | Human Touch | Gemini | 感情・体験談・共感要素の生成 |
| 4 | アウトライン | Claude | 戦略的な記事構成 |
| 5 | 一次情報収集 | Gemini+Web | 信頼できる情報源の収集 |
| 6 | アウトライン強化 | Claude | 情報を反映した構成の強化 |
| 6.5 | 統合パッケージ | Claude | 全情報の集約 |
| 7A | 本文初稿 | Claude | 記事本文の初稿 |
| 7B | ブラッシュアップ | Gemini | 本文の磨き上げ |
| 8 | ファクトチェック | Gemini+Web | 事実確認とFAQ生成 |
| 9 | 最終リライト | Claude | 最終仕上げ |
| 10 | 4記事生成 | Claude | 4つのバリエーション記事を生成 |
| 11 | 画像生成 | Gemini+API | 記事用画像（オプション） |
| 12 | WordPress変換 | Claude | Gutenbergブロック形式に変換 |

---

## 工程10: 4つの記事バリエーション

最終工程では、同じテーマから4種類の記事が自動生成されます:

| 記事 | タイプ | ターゲット |
|------|--------|-----------|
| 記事1 | メイン記事 | SEOに関心がある全読者 |
| 記事2 | 初心者向け | これから学び始める人 |
| 記事3 | 実践編 | 実践ノウハウを求める中級者 |
| 記事4 | まとめ | 要点を素早く把握したい人 |

---

## エラー時の対応

工程がエラー（赤）になった場合:

1. エラーの工程をクリックして詳細を確認
2. **「リトライ」** ボタンがある場合はクリックして再実行
3. APIキーの問題の場合は、設定画面でキーを確認
4. 解決しない場合は `docker compose logs worker` でログを確認
